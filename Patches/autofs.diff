diff -Naur autofs-4.1.4/Makefile.conf autofs-4.1.4-fixed/Makefile.conf
--- autofs-4.1.4/Makefile.conf	1970-01-01 01:00:00.000000000 +0100
+++ autofs-4.1.4-fixed/Makefile.conf	2006-01-12 13:52:14.000000000 +0100
@@ -0,0 +1,65 @@
+#
+# $id$
+#
+# Makefile.conf.in
+#
+# Pattern file to be filled in by configure; contains specific options to
+# build autofs.
+#
+
+#CC = powerpc-tuxbox-linux-gnu-gcc
+#CFLAGS = -fPIE -mcpu=823 -mmultiple -mstring -meabi -pipe -Os
+#LDFLAGS = -pie -s
+#STRIP = powerpc-tuxbox-linux-gnu-strip
+
+# Do we build with -fpie?
+DAEMON_CFLAGS  = -fPIE
+DAEMON_LDFLAGS = -pie
+
+# Special parameters for glibc (libc 6)
+LIBNSL    = -lnsl
+LIBRESOLV = -lresolv
+
+# Hesiod support: yes (1) no (0)
+HESIOD = 0
+LIBHESIOD = 
+HESIOD_FLAGS = 
+
+# LDAP support: yes (1) no (0)
+LDAP = 0
+LIBLDAP= 
+LDAP_FLAGS = 
+
+# NIS+ support: yes (1) no (0)
+NISPLUS = 0
+
+# SMBFS support: yes (1) no (0)
+SMBFS = 0
+
+# Support for calling e2fsck when mounting ext2 filesystems
+EXT2FS = 0
+
+# Support for calling e3fsck when mounting ext3 filesystems
+EXT3FS = 0
+
+#
+# Note: the DESTDIR define is so you can build autofs into a temporary
+# directory and still have all the compiled-in paths point to the right
+# place.
+#
+
+# Common install prefix
+prefix = /
+exec_prefix = ${prefix}
+
+# Directory for autofs modules
+autofslibdir = ${exec_prefix}/lib/autofs
+
+# Where to install the automount program
+sbindir = ${exec_prefix}/sbin
+
+# Where to install man pages
+mandir = ${prefix}/man
+
+# Location for init.d files
+initdir = /etc/init.d
diff -Naur autofs-4.1.4/Makefile.rules autofs-4.1.4-fixed/Makefile.rules
--- autofs-4.1.4/Makefile.rules	2004-01-29 17:01:22.000000000 +0100
+++ autofs-4.1.4-fixed/Makefile.rules	2006-01-12 13:43:47.000000000 +0100
@@ -17,20 +17,20 @@
 # Compilers, linkers and flags
 # The STRIP defined here *must not* remove any dynamic-loading symbols
 
-ifdef DEBUG
-CFLAGS    = -O2 -g -DDEBUG
-LDFLAGS   = -g
-STRIP     = :
-else
-CFLAGS    = -O3 -fomit-frame-pointer -Wall
-LDFLAGS   = -s
-STRIP     = strip --strip-debug
-endif
-
-CC        = gcc
-CXX       = g++
-CXXFLAGS  = $(CFLAGS)
-LD        = ld
+#ifdef DEBUG
+#CFLAGS    = -O2 -g -DDEBUG
+#LDFLAGS   = -g
+#STRIP     = :
+#else
+#CFLAGS    = -O3 -fomit-frame-pointer -Wall
+#LDFLAGS   = -s
+#STRIP     = strip --strip-debug
+#endif
+
+#CC        = gcc
+#CXX       = g++
+#CXXFLAGS  = $(CFLAGS)
+#LD        = ld
 SOLDFLAGS = -shared -Xlinker -rpath -Xlinker $(autofslibdir)
 
 # Standard rules
diff -Naur autofs-4.1.4/include/config.h autofs-4.1.4-fixed/include/config.h
--- autofs-4.1.4/include/config.h	1970-01-01 01:00:00.000000000 +0100
+++ autofs-4.1.4-fixed/include/config.h	2006-01-12 11:06:38.000000000 +0100
@@ -0,0 +1,28 @@
+/* include/config.h.  Generated by configure.  */
+#ident "$Id: config.h.in,v 1.4 2004/02/03 15:23:21 raven Exp $"
+/* -*- c -*-
+ *
+ * config.h.in: Pattern file for autofs to be filled in by configure
+ *
+ */
+
+/* Program paths */
+#define HAVE_MOUNT 1
+#define PATH_MOUNT "/bin/mount"
+
+#define HAVE_UMOUNT 1
+#define PATH_UMOUNT "/bin/umount"
+
+/* #undef HAVE_SMBMOUNT */
+/* #undef PATH_SMBMOUNT */
+
+/* #undef HAVE_E2FSCK */
+/* #undef PATH_E2FSCK */
+
+/* #undef HAVE_E3FSCK */
+/* #undef PATH_E3FSCK */
+
+/* Define this option if mount(8) supports the -s (sloppy) option */
+/* #undef HAVE_SLOPPY_MOUNT */
+
+/* #undef ENABLE_EXT_ENV */
diff -Naur autofs-4.1.4/lib/rpc_subs.c autofs-4.1.4-new/lib/rpc_subs.c
--- autofs-4.1.4/lib/rpc_subs.c	2004-11-20 16:08:38.000000000 +0100
+++ autofs-4.1.4-new/lib/rpc_subs.c	2007-09-26 17:59:57.000000000 +0200
@@ -16,7 +16,7 @@
 
 #include <rpc/rpc.h>
 #include <rpc/pmap_prot.h>
-#include <nfs/nfs.h>
+#include <linux/nfs.h>
 #include <linux/nfs2.h>
 #include <linux/nfs3.h>
 #include <rpc/xdr.h>
diff -Naur autofs-4.1.4-orig/modules/Makefile autofs-4.1.4/modules/Makefile
--- autofs-4.1.4-orig/modules/Makefile	2007-09-29 12:45:56.000000000 +0200
+++ autofs-4.1.4/modules/Makefile	2007-09-29 12:46:16.000000000 +0200
@@ -6,13 +6,13 @@
 -include ../Makefile.conf
 include ../Makefile.rules
 
-SRCS :=	lookup_yp.c  lookup_file.c  lookup_program.c  lookup_userhome.c \
+SRCS :=	lookup_file.c  lookup_program.c  lookup_userhome.c \
 	lookup_multi.c \
 	parse_sun.c    \
 	mount_generic.c  mount_nfs.c  mount_afs.c  mount_autofs.c \
 	mount_changer.c  mount_bind.c
 
-MODS :=	lookup_yp.so lookup_file.so lookup_program.so lookup_userhome.so \
+MODS :=	lookup_file.so lookup_program.so lookup_userhome.so \
 	lookup_multi.so \
 	parse_sun.so \
 	mount_generic.so mount_nfs.so mount_afs.so mount_autofs.so \
@@ -43,6 +43,11 @@
   MODS += lookup_ldap.so
 endif
 
+ifeq ($(YP), 1)
+  SRCS += lookup_yp.c
+  MODS += lookup_yp.so
+endif
+
 CFLAGS += -I../include -fPIC -DAUTOFS_LIB_DIR=\"$(autofslibdir)\" -DPATH_AUTOMOUNT=\"$(sbindir)/automount\"
 
 all: $(MODS)
