#!/bin/sh

PATH=/sbin:/bin

hostname -F /etc/hostname
mount -a
echo -n >/etc/network/ifstate
ifup -a

test -O /bin/tinylogin || chown root.root /bin/tinylogin

test -x /sbin/inetd && inetd

if test -x /sbin/sshd ; then
	/etc/init.d/start_sshd &
fi

@TARGETRULESET_FLASH_TRUE@test -d /var/lib/modules/`uname -r` || mkdir -p /var/lib/modules/`uname -r`
@TARGETRULESET_FLASH_TRUE@test -f /var/lib/modules/`uname -r`/modules.dep || \
depmod -ae

modprobe tuxbox

. /etc/profile

modprobe dvb-core

# D-BOX2
if [ $TUXBOX_MODEL -eq 1 ]; then

	# I2C core
	modprobe dbox2_i2c

	# Frontprozessor
	modprobe dbox2_fp
	modprobe dbox2_fp_input

	# Frontends
	# Nokia
	if [ $TUXBOX_MANUFACTURER -eq 1 ]; then
		modprobe ves1820
		modprobe ves1x93 board_type=2
		modprobe ves1x93 board_type=3
	# Sagem
	elif [ $TUXBOX_MANUFACTURER -eq 2 ]; then
		modprobe at76c651
		modprobe ves1x93 board_type=4
	# Philips
	elif [ $TUXBOX_MANUFACTURER -eq 3 ]; then
		modprobe tda8044h
	fi

	# Misc IO
	modprobe avs
	modprobe saa7126
	modprobe cam

	# A/V
	modprobe avia_gt
	modprobe avia_gt_fb
	modprobe avia_gt_oss
	modprobe avia_av

	modprobe avia_napi
	modprobe dbox2_i2c_napi
	modprobe dbox2_fp_napi
	modprobe cam_napi
	modprobe avia_av_napi
	modprobe avia_gt_napi

	modprobe lcd

# Dreambox DM 7000
elif [ $TUXBOX_MODEL -eq 2 ]; then

	# I2C core

	# Frontprozessor

	# Frontends
	modprobe alps_bsru6
	modprobe alps_tdme7
	modprobe philips_1216
	
	# Misc IO

	# A/V

fi

# compatibility links
ln -sf demux0 /dev/dvb/adapter0/demux1
ln -sf dvr0 /dev/dvb/adapter0/dvr1
ln -sf fb/0 /dev/fb0

test -x /bin/loadkeys && loadkeys /share/keymaps/i386/qwertz/de-latin1.kmap.gz
